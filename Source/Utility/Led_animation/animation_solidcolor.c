/**********************************************************************************************************************
 * Includes
 *********************************************************************************************************************/

#include "animation_solidcolor.h"

#include <stddef.h>

/**********************************************************************************************************************
 * Private definitions and macros
 *********************************************************************************************************************/

/**********************************************************************************************************************
 * Private typedef
 *********************************************************************************************************************/

/**********************************************************************************************************************
 * Private constants
 *********************************************************************************************************************/
 
/**********************************************************************************************************************
 * Private variables
 *********************************************************************************************************************/
 
/**********************************************************************************************************************
 * Exported variables and references
 *********************************************************************************************************************/

/**********************************************************************************************************************
 * Prototypes of private functions
 *********************************************************************************************************************/
 
void Animation_SolidColor_FillBuffer (sSolidAnimationData_t *data);

/**********************************************************************************************************************
 * Definitions of private functions
 *********************************************************************************************************************/

void Animation_SolidColor_FillBuffer (sSolidAnimationData_t *data) {
    if (data == NULL) {
        return;
    }
    
    if (!WS2812B_API_IsCorrectDevice(data->device)) {
        return;
    }

    if (data->brightness == 0) {
        return;
    }

    uint8_t r = (data->rgb.color >> 16) & 0xFF;
    uint8_t g = (data->rgb.color >> 8) & 0xFF;
    uint8_t b = data->rgb.color & 0xFF;

    r = LED_ScaleBrightness(r, data->brightness);
    g = LED_ScaleBrightness(g, data->brightness);
    b = LED_ScaleBrightness(b, data->brightness);

    WS2812B_API_FillColor(data->device, r, g, b);

    return;
}

/**********************************************************************************************************************
 * Definitions of exported functions
 *********************************************************************************************************************/

void Animation_SolidColor_Run (void *context) {
    if (context == NULL) {
        return;
    }
    
    Animation_SolidColor_FillBuffer((sSolidAnimationData_t*) context);

    return;
}
